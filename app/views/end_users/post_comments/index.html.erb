<div class="main">
  <%= render "layouts/navbar" %>
  <section class="comments">
    <h4><div class="comments_back"><%= link_to "戻る", 'javascript:history.back()' %></div></h4>
    <%= render 'end_users/hobbies/hobby-top', hobby: @hobby %>
    <div class="post-one_bottom">
      <div class="comments_post">
        <div class="comments_post-main">
          <div class="comments_post-user">
          <%= link_to user_page_path(@post.end_user.id), class:"comments_user-link" do %>
            <%= attachment_image_tag @post.end_user, :user_image, size: "70x70", fallback: "no_image.jpg" %>
            <%= @post.end_user.name %>
          <% end %>
            <div class="comments_post-created">
              <div class="comments_post-created-time"><%= @post.created_at.strftime("%Y/%m/%d/ %H:%M") %></div>
              <div class="comments_post-created-hobby"><%= @post.hobby.title %></div>
            </div>
          </div>

          <%= link_to hobby_post_path(@post.hobby, @post), class:"posts_post-link" do %>
            <h4 class="posts_post-title"><%= @post.title %></h4>
            <div class="posts_post-list">
              <% @post.tags.each do |tag| %>
                  <span class="posts_post-tag">#<%= tag.name %></span>
              <% end %>
            </div>
          <% end %>
        </div>

        <div class="comments_sub">
          <div class="comments_content">
            <h6><%= image_tag "eye.jpg" %><%= @post.impressionist_count(:filter => :session_hash) %></h6>
            <h6 class="comments_comment-count"><%= image_tag "comment.jpg" %><%= @post.post_comments.count %>件</h6>
            <% if end_user_signed_in? %>
              <% if @post.favorite_posts?(current_end_user) %>
                <div class="comments_favorite" id="post-favorite-button-<%= @post.id %>">
                  <%= render "end_users/favorite_posts/unpost-favorite", post: @post %>
                </div>
              <% elsif %>
                <div class="comments_favorite" id="post-favorite-button-<%= @post.id %>">
                  <%= render "end_users/favorite_posts/post-favorite", post: @post %>
                </div>
              <% end %>
            <% elsif %>
              <h6>いいね♡<%= @post.favorite_posts.count %></h6>
            <% end %>
          </div>

          <% if end_user_signed_in? %>
            <%= form_with(model: [:end_users, @hobby, @post, @new_comment], url: hobby_post_post_comments_path(@hobby,@post), local: true) do |f| %>
              <div class="comments_form">
                <%= f.label :comment, "コメント追加:" %>
                <%= f.text_field :comment, class: "comments_text-field" %>
                <%= f.submit "コメントする" %>
              </div>
            <% end %>
          <% end %>

          <% @comments.each do |c| %>
            <div class="comments_comment">
              <div class="comments_comment-user">
                <%= link_to user_page_path(c.end_user.id) do %>
                  <%= attachment_image_tag c.end_user, :user_image, size: "50x50", fallback: "no_image.jpg", format: "jpg" %>
                  <%= c.end_user.name %>
                <% end %>
                <div class="comments_comment-created">
                  <%= c.created_at.strftime("%Y/%m/%d/ %H:%M") %>
                </div>
              </div>
              <div class="comments_comment-main">
                <%= c.comment %>
                <div class="comments_destroy">
                  <%= link_to "削除する", hobby_post_post_comment_path(@hobby, @post, c), class: "", method: :delete %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </section>
</div>